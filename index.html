<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Analisador de Roleta</title>

  <style>
    body {
      margin: 0;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      background: #0b0f14;
      color: #d7dbe2;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .box {
      background: #12161c;
      padding: 24px;
      border-radius: 20px;
      width: 420px;
      box-shadow: 0 20px 40px rgba(0,0,0,.4);
    }

    h1 {
      color: #FFD700;
      text-align: center;
      margin: 0 0 16px;
      font-size: 24px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px 18px;
      justify-items: center;
      margin-bottom: 16px;
      font-size: 26px;
    }

    .cell {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .bracket { color: #6f7b8a; }

    input {
      width: 60px;
      background: transparent;
      border: 0;
      outline: none;
      color: #f0b35a;
      font-size: 26px;
      text-align: center;
    }

    button {
      cursor: pointer;
      border-radius: 12px;
      border: none;
      font-weight: 800;
      font-family: inherit;
    }

    .btnCalc {
      display: block;
      margin: 0 auto;
      width: 100%;
      padding: 12px 18px;
      background: #1e90ff;
      color: #ffffff;
      font-size: 16px;
      letter-spacing: 1px;
      box-shadow: 0 8px 18px rgba(30, 144, 255, .25);
    }

    .resultado {
      margin-top: 14px;
      font-size: 22px;
      color: #aeb8c4;
    }

    .resultado span {
      display: block;
      margin-top: 6px;
      font-size: 28px;
      color: #f0b35a;
      letter-spacing: 2px;
    }

    .rowBtns {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }

    .btnSmall {
      flex: 1;
      padding: 10px;
      background: #2b3340;
      color: #fff;
      font-weight: 800;
    }

    .btnDanger { background: #c0392b; }

    .historico {
      margin-top: 16px;
      background: #0f1319;
      border-radius: 14px;
      padding: 12px;
      display: none;
    }

    .item {
      font-size: 12px;
      margin-bottom: 8px;
      color: #c9d2dd;
    }

    .muted { color: #8aa0b6; }
  </style>
</head>

<body>
<div class="box">
  <h1>Coloque seus números</h1>

  <div class="grid" id="grid"></div>

  <button class="btnCalc" id="btnCalc">CALCULAR</button>

  <div class="resultado" id="resWrap" style="display:none;">
    Jogada sugerida:
    <span id="resultado"></span>
  </div>

  <div class="rowBtns">
    <button class="btnSmall" id="btnLimpar">LIMPAR</button>
    <button class="btnSmall btnDanger" id="btnApagar">APAGAR HISTÓRICO</button>
  </div>

  <div class="historico" id="histWrap"></div>
</div>

<script>
  // Tabela "sequência" (coração já está certo, aqui é a sequência)
  const regra = {0:3,1:4,2:5,3:6,4:7,5:8,6:9,7:0,8:1,9:2};
  const KEY = 'roleta_hist_v4';

  function proximo(inicial, usados) {
    let a = inicial;
    while (usados.includes(a)) a = regra[a];
    return a;
  }

  const inputs = [];
  const grid = document.getElementById('grid');

  for (let i = 0; i < 6; i++) {
    const c = document.createElement('div');
    c.className = 'cell';

    const l = document.createElement('span');
    l.className = 'bracket';
    l.textContent = '[';

    const inp = document.createElement('input');
    inp.addEventListener('input', () => inp.value = inp.value.replace(/[^\d-]/g,''));

    const r = document.createElement('span');
    r.className = 'bracket';
    r.textContent = ']';

    c.append(l, inp, r);
    grid.appendChild(c);
    inputs.push(inp);
  }

  function calcular() {
    const usados = [];
    const jogada = [];

    // ordem por coluna (igual papel)
    const ordem = [0,3,1,4,2,5];

    // calcula os 6 resultados base (sem extra ainda)
    const base = [];
    ordem.forEach(i => {
      const n = parseInt(inputs[i].value, 10);
      if (isNaN(n)) return;

      const t = Math.abs(n) % 10;
      let c = proximo(regra[t], usados);
      usados.push(c);
      base.push(c);
    });

    if (!base.length) return;

    // ✅ REGRA NOVA: extra vem LOGO DEPOIS do PRIMEIRO número
    // Extra é calculado a partir do "próximo" do primeiro número base
    let extra = proximo(regra[base[0]], usados);

    // monta saída final: [primeiro, extra, resto...]
    jogada.push(base[0]);
    jogada.push(extra);
    for (let k = 1; k < base.length; k++) jogada.push(base[k]);

    document.getElementById('resultado').textContent = jogada.join(' - ');
    document.getElementById('resWrap').style.display = '';

    salvarHist(jogada);
    renderHist();
  }

  function limpar() {
    inputs.forEach(i => i.value = '');
    document.getElementById('resWrap').style.display = 'none';
    inputs[0].focus();
  }

  function salvarHist(jogada) {
    const h = JSON.parse(localStorage.getItem(KEY) || '[]');
    h.push({d:new Date().toLocaleString('pt-BR'), j:jogada});
    while (h.length > 30) h.shift();
    localStorage.setItem(KEY, JSON.stringify(h));
  }

  function renderHist() {
    const h = JSON.parse(localStorage.getItem(KEY) || '[]');
    const w = document.getElementById('histWrap');
    w.innerHTML = '';
    w.style.display = h.length ? '' : 'none';

    h.slice().reverse().forEach(x => {
      const d = document.createElement('div');
      d.className = 'item';
      d.innerHTML = `<span class="muted">${x.d}</span><br>${x.j.join(' - ')}`;
      w.appendChild(d);
    });
  }

  document.getElementById('btnCalc').onclick = calcular;
  document.getElementById('btnLimpar').onclick = limpar;
  document.getElementById('btnApagar').onclick = () => {
    localStorage.removeItem(KEY);
    renderHist();
  };

  renderHist();
</script>
</body>
</html>
